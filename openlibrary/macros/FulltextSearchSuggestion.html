$def with(query, results, page=1)

$def render_snippet(query, doc):
    $:macros.FulltextSuggestionSnippet(query, doc=doc)

$if results and results.get('hits'):
  $ hits = results['hits'].get('hits', [])[:3]
  $ num_found = commify(results['hits'].get('total', 0))
  $ ia_base_url = "https://archive.org"
  <div id="fulltextSuggestions" class="fulltext-suggestions">
    <div class="header">
      <a href="/search/inside?$urlencode(dict(q=query))" title="$_('Search Inside Icon')">
          <img src="/static/images/icons/icon_search-inside.svg"
            width="50" height="47"
            alt="$_('search inside icon')"/>
      </a>
      <h3 class="title"><a data-ol-link-track="SearchNav|SearchFulltext"
        href="/search/inside?$urlencode(dict(q=query))">$_('Browse %(results_count)s Search Inside Matches', results_count=num_found)</a>
      </h3>
    </div>
    <div className="fsi__container">
      $for doc in hits:
        $if doc.get('edition'):
          $:macros.FulltextSearchSuggestionItem(doc['edition'], extra=render_snippet(query, doc))
    </div>
  </div>
