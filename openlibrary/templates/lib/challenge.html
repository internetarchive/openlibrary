$def with (redirect_url)

$var title: $_("Human Verification")

<div id="contentHead">
    <h1>$_("Human Verification")</h1>
</div>

<div id="contentBody" style="text-align: center; padding: 2rem;">
    <p style="margin-bottom: 2rem;">$_("Please verify you are human to continue.")</p>
    <button id="verify-human-btn" class="cta-btn cta-btn--shell" style="padding: 1rem 2rem; font-size: 1.1rem;">
        $_("Verify you are human")
    </button>
</div>

<script>
(function() {
    var button = document.getElementById('verify-human-btn');
    // Safely escape the redirect URL for use in JSON
    var redirectUrl = $:json.dumps(redirect_url);
    var verifyingText = $:json.dumps(_("Verifying..."));
    var errorText = $:json.dumps(_("Verification failed. Please try again."));
    var buttonText = $:json.dumps(_("Verify you are human"));

    button.addEventListener('click', function() {
        button.disabled = true;
        button.textContent = verifyingText;

        fetch('/account/verify_human', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ redirect_url: redirectUrl })
        })
        .then(function(response) {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Verification failed');
        })
        .then(function(data) {
            if (data.redirect) {
                window.location.href = data.redirect;
            } else {
                window.location.reload();
            }
        })
        .catch(function(error) {
            console.error('Verification error:', error);
            alert(errorText);
            button.disabled = false;
            button.textContent = buttonText;
        });
    });
})();
</script>
