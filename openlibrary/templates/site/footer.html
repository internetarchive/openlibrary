$def with (page=None)

$ show_ol_shell = ctx.get('show_ol_shell', True)

<!--For analytics-->
$ stats = stats_summary()
$ raw_time = stats.get('total', {}).get('time') # Assumes that if total present, it's a dict
$if raw_time is not None:
  $ total_time = float(raw_time) * 1000
$else:
  $ total_time = 0

$if show_ol_shell:
  <div class="clearfix"></div>

$if ("stats" in ctx.features) and query_param('debug'):
    $:render_template("site/stats")

$if show_ol_shell:
  $:render_template("lib/nav_foot", page)

<!--Will be moved inside index.js-->
<script type="text/javascript">
  if ("serviceWorker" in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register("/sw.js").then(registration => {

      }).catch(error => {
        console.log("ServiceWorker registration failed");
      });
    });
  }

  window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent the mini-infobar from appearing on mobile
    e.preventDefault();
  });
</script>

<!-- Must be loaded after jquery -->
<script src="/cdn/archive.org/analytics.js" type="text/javascript" defer></script>
<script src="$static_url('build/all.js')" type="text/javascript"></script>
<!-- Passes total_time for analytics to ol.analytics.js -->
<div class="analytics-stats-time-calculator" data-time="$total_time"></div>

<!-- clear the window.q and setup the jQuery plugins -->
<script>
\$( function () {
    var i;
    for ( i = 0; i < window.q.length; i++ ) {
        \$( window.q[i] );
    }
    window.q = [];
} );

if (typeof archive_analytics !== 'undefined') {
  archive_analytics.set_up_event_tracking();
}
</script>
</body>
</html>
