$def with(book, size="M")

$ title = book.title
$ author_names = None
$if any(book.get_authors()):
    $ author_names = ", ".join(a.get("name", "Name missing") for a in book.get_authors())
$if not author_names:
    $ author_names = book.get('by_statement','')

$ cover_url = book.get_cover_url(size)

$ cover_lg = book.get_cover_url("L")

$if size == "M":
    <div class="coverMagic cover-animation">
            <div class="SRPCover bookCover" style="display: $cond(cover_url, 'block', 'none');">
                <a href="$cover_lg" aria-controls="seeImage"
                    class="coverLook dialog--open" title="$_('Pull up a bigger book cover')"><img itemprop="image" src="$cover_url" srcset="$cover_lg 2x" class="cover" alt="$_('Cover of: %(title)s by %(authors)s', title=title, authors=author_names)"/></a>
            </div>
            <div class="SRPCoverBlank" style="display: $cond(not cover_url, 'block', 'none');">
                <div class="innerBorder">
                    <div class="BookTitle">$:macros.TruncateString(title, 70)
                        <div class="Author">$:macros.TruncateString(author_names, 30)</div>
                    </div>
                </div>
            </div>
    </div>
$else:
    <img src="$(cover_url or '/images/icons/avatar_book-sm.png')" srcset="$cover_lg 2x" height="58" title="$title" alt="$_('We need a book cover for: %(title)s', title=title)"/>

<div class="hidden">
    <div class="coverFloat" id="seeImage">
        <div class="coverFloatHead">
            <h2>$:macros.TruncateString(title, 70)</h2>
            <a class="dialog--close">&times;<span class="shift">$_("Close")</span></a>
        </div>
        <a class="dialog--close"><img src="$cover_lg" class="cover" alt="$title $_('by') $author_names"/></a>
    </div>
</div>
