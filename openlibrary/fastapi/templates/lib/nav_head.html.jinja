{% set is_privileged_user = ctx.user and (ctx.user.is_admin() or ctx.user.is_super_librarian() or ctx.user.is_librarian()) %}
<header id="header-bar" class="header-bar">

  {% if ctx.user %}
    {% set loginLinks = [
         { "href": "/account/books", "text": ("My Books"), "track": "MyBooks", "subheading": ("Loans, Reading Log, Lists, Stats") },
         { "href": ctx.user.key, "text": ("My Profile"), "track": "MyProfile" },
         { "href": homepath() + "/account", "text": ("Settings"), "track": "MySettings" },
         { "post": "/account/logout", "text": ("Log out"), "track": "Logout", "name":"hamburger-logout" },
    ] %}
      {% if is_privileged_user %}
        {% set _ = loginLinks.insert(2, { "href": homepath() + "/merges", "text": ("Pending Merge Requests"),"track": "MyRequests", "badge": True }) %}
      {% endif %}
  {% else %}
    {% set loginLinks = [
         { "loginClass": "login-links" }
    ] %}
  {% endif %}
  {% set myBooksLinks = [
       { "href": homepath() + "/account/books", "text": ("My Books"), "track": "MyBooks" },
  ] %}
  {% set browseLinks = [
       { "href": "/subjects", "text": ("Subjects"), "track": "Subjects" },
       { "href": "/trending", "text": ("Trending"), "track": "Trending" },
       { "href": "/explore", "text": ("Library Explorer"), "track": "Explore" },
       { "href": "/lists", "text": ("Lists"), "track": "Lists" },
       { "href": "/collections", "text": ("Collections"), "track": "Collections" },
       { "href": "/k-12", "text": ("K-12 Student Library"), "track": "K12Library" },
       { "href": "/booktalks", "text": ("Book Talks"), "track": "BookTalks" },
       { "href": "/random", "text": ("Random Book"), "track": "RandomBook" },
       { "href": "/advancedsearch", "text": ("Advanced Search"), "track": "AdvancedSearch" }
  ] %}
  {% set contributeLinks = [
       { "href": "/books/add", "text": ("Add a Book"), "track": "AddBook" },
       { "href": "/recentchanges", "text": ("Recent Community Edits"), "track": "RecentEdits" }
  ] %}
  {% set resourceLinks = [
       { "href": "/help", "text": ("Help & Support"), "track": "Help" },
       { "href": "/developers", "text": ("Developer Center"), "track": "DevelopersHelp" },
       { "href": "/librarians", "text": ("Librarians Portal"), "track": "LibrariansHelp" }
  ] %}
  {% set hamburgerProps = {
    'name': 'hamburger',
    'links': [ { "subsection": ("My Open Library") } ] + loginLinks +
         [ { "subsection": ("Browse") } ] + browseLinks +
         [ { "subsection": ("Contribute") } ] + contributeLinks +
         [ { "subsection": ("Resources") } ] + resourceLinks,
    'image': '/static/images/hamburger-icon.svg',
    'image-class': 'hamburger__icon',
    'label': 'additional options menu',
    'show_mask': True
  } %}

  <div class="logo-component">
    <a href="/" title="{{ ('The Internet Archive\'s Open Library: One page for every book') }}">
      <div class="logo-txt">
        <img class="logo-icon" src="/static/images/openlibrary-logo-tighter.svg"
          width="189" height="47"
          alt="{{ ('Open Library logo') }}"/>
      </div>
    </a>
  </div>

  {% set browseProps = {
     'name': 'browse',
     'label': ('Browse'),
     'links': browseLinks
  } %}

  {% set myBooksProps = {
     'name': 'mybooks',
     'label': ('My Books'),
     'links': myBooksLinks
  } %}
  <ul class="navigation-component">
    <li>{{ render_template("lib/header_dropdown", myBooksProps, track_prefix="MainNav") | safe}}</li>
    <li>{{ render_template("lib/header_dropdown", browseProps, track_prefix="MainNav") | safe}}</li>
  </ul>

  <div class="search-component">
    <div class="search-bar-component">
      <div class="search-bar">
        <div class="search-facet">
          <label class="search-facet-selector">
            <span aria-hidden="true" class="search-facet-value">{{ ("All") }}</span>
            <select aria-label="Search by">
              <option value="all">{{ ("All") }}</option>
              <option value="title">{{ ("Title") }}</option>
              <option value="author">{{ ("Author") }}</option>
              <option value="text">{{ ("Text") }}</option>
              <option value="subject">{{ ("Subject") }}</option>
              <option value="lists">{{ ("Lists") }}</option>
              <option value="advanced">{{ ("Advanced") }}</option>
            </select>
          </label>
        </div>
        <form class="search-bar-input" action="/search" method="get">
          <input type="text" name="q" placeholder="{{ ('Search') }}" aria-label="Search" autocomplete="off">
          <input name="mode" type="checkbox" aria-hidden="true" aria-label="Search checkbox" checked="checked" value="" id="ftokenstop" class="hidden instantsearch-mode">
          <input type="submit" value="" class="search-bar-submit" aria-label="Search submit">
          <div class="vertical-separator"></div>
          <a
            id="barcode_scanner_link"
            class="search-by-barcode-submit"
            aria-label="{{ ('Search by barcode') }}"
            title="{{ ('Search by barcode') }}"
            href="/barcodescanner?returnTo=/isbn/$$$$$$"
          >
          </a>
        </form>
      </div>
      <div class="search-dropdown">
        <ul class="search-results">
        </ul>
      </div>
    </div>
  </div>

  {% if not ctx.user %}
    <ul class="auth-component">
      <li class="hide-me">
        <a class="btn"
           href="/account/login">{{ ("Log In") }}</a></li>
      <li><a class="btn primary" href="/account/create">{{ ("Sign Up") }}</a></li>
    </ul>
  {% endif %}

  {# {{ render_template("lib/header_dropdown", hamburgerProps, track_prefix="Hamburger") | safe}} #}
  {% with props=hamburgerProps, track_prefix="Hamburger" %}
    {% include "lib/header_dropdown.html.jinja" %}
  {% endwith %}


</header>
<header class="header-bar mobile">
  <ul class="navigation-component mobile">
    <li>{{ render_template("lib/header_dropdown", myBooksProps, track_prefix="MainNav") | safe}}</li>
    <li>{{ render_template("lib/header_dropdown", browseProps, track_prefix="MainNav") | safe}}</li>
  </ul>
</header>