{#
  @typedef {Object} DropdownLink
  @property {string} text of link
  @property {string|null} href of link for HTTP get request
  @property {string|null} post when set will be used instead of href and should use HTTP POST request.
  @property {string|null} `track` event label for google analytics
  @property {string|null} subheading that will appear below the link text

  @param {Object} props template properties
  @param {string} props.name unique identifying name for dropdown and distinguishing it from other dropdowns
  @param {string} props.label for menu, also used as alt text for dropdown icon when props.image is set
  @param {string|null} props.image URL for image (optional)
  @param {DropdownLink[]} props.links
#}
{% set singleton = props.get('links', []) | length == 1 %}
{% set is_privileged_user = ctx.user and (ctx.user.is_admin() or ctx.user.is_super_librarian()) %}

<div class="{{ props['name'] }}-component header-dropdown">
  {% if singleton %}
    {% set link = props['links'][0] %}
    {% set tracker = 'data-ol-link-track=%s|%s' % (track_prefix, link['track']) if (track_prefix and link.get('track')) else '' %}
    <a href="{{ link['href'] }}" {{ tracker | safe }}>{{ props['label'] }}</a>
  {% else %}
    <details>
      <summary {% if props['name'] == 'hamburger' %}data-ol-link-track="HeaderBar|Hamburger"{% endif %}>
        {% if props['name'] == 'hamburger' and ctx.user %}
            <img class="account__icon" src="https://archive.org/services/img/{{ get_internet_archive_id(ctx.user.key) }}" alt="{{ ('My account') }}" title="{{ ctx.user.key.split('/')[-1] ~ '\n' ~ ('Joined dates') }}">
            <span class="mr-notifications">{{ cached_get_counts_by_mode(mode='open') }}</span>
        {% elif 'image' in props %}
            <img class="{{ props['image-class'] }}" src="{{ props['image'] }}" alt="{{ props['label'] }}"/>
        {% elif 'label' in props %}
            {{ props['label'] }}
            <span class="shift">{{ ('Menu') }}</span>
        {% endif %}

        <img class="down-arrow" aria-hidden="true" src="/static/images/down-arrow.png" alt="" role="presentation" width="7" height="4">
      </summary>
      {% if 'show_mask' in props %}
        <div class="mask-menu"></div>
      {% endif %}
      <div
      {% if props['name'] == 'hamburger' %}
        class="app-drawer"
      {% elif not singleton %}
        class="{{ props['name'] }}-dropdown-component navigation-dropdown-component"
      {% endif %}
      >
        <ul class="dropdown-menu {{ props['name'] }}-dropdown-menu">
          {% for link in props['links'] %}
            {% set tracker = 'data-ol-link-track=%s|%s' % (track_prefix, link['track']) if (track_prefix and link.get('track')) else '' %}
            {% if 'subsection' in link %}
              <li class="subsection">
                {{ link['subsection'] }}
              </li>
            {% elif 'loginClass' in link %}
              <li class="{{ link['loginClass'] }}">
                <a class="login-links__secondary" href="/account/login">{{ ('Log In') }}</a>
                <a class="login-links__primary" href="/account/create">{{ ('Sign Up') }}</a>
              </li>
            {% else %}
              <li>
              {% if 'post' in link %}
                {% set name = 'name=%s' % link['name'] if 'name' in link else '' %}
                <form {{ name | safe }} action="{{ link['post'] }}" method="post">
                  <button {{ tracker | safe }}>{{ link["text"] }}</button>
                </form>
              {% else %}
                {% if is_privileged_user %}
                  {% if 'badge' in link and cached_get_counts_by_mode(mode='open') > 0 %}
                    <div class="app-drawer__badge">{{ cached_get_counts_by_mode(mode='open') }}</div>
                  {% endif %}
                {% endif %}
                <a href="{{ link['href'] }}" {{ tracker | safe }}>
                  {% if 'new' in link and props['name'] == 'hamburger' %}
                    <span>{{ link['text'] }}</span><span class="app-drawer__badge">{{ ('New!') }}</span>
                  {% else %}
                    {{ link['text'] }}
                    {% if 'subheading' in link %}
                      <br>
                      <i class="subheading">{{ link['subheading'] }}</i>
                    {% endif %}
                  {% endif %}
                </a>
              {% endif %}
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </details>
  {% endif %}
</div>